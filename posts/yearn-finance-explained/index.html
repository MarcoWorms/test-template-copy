<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marco Guaspari Worms">
<meta name="dcterms.date" content="2022-05-19">

<title>Worms Blog - Yearn Finance explained: What are Vaults and Strategies?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Worms Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MarcoWorms" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MarcoWorms" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Yearn Finance explained: What are Vaults and Strategies?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">english</div>
                <div class="quarto-category">yearn</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Marco Guaspari Worms </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 19, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/8472/1*w_yyTn8XhKgxyiLPiEyVCw.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Simple Ethereum Yearn Vault Example</figcaption>
</figure>
</div>
<p><a href="http://yearn.finance/">Yearn Finance</a> is a suite of Decentralized Finance (DeFi) products that provides yield generation, lending aggregation, and more on the blockchain. Yearn is maintained by various independent developers and is <a href="https://medium.com/iearn/yearn-governance-explained-proposals-yfi-token-and-execution-113ec86c3a3f">governed by $YFI holders.</a></p>
<p>The current user-facing core product of Yearn is <strong>yVault</strong>, which provides automated yield generation to many different crypto assets, each driven by one or more <strong>Strategies.</strong> The yVault design is open-ended, which means other protocols can build and innovate on top of Yearn, like the <a href="https://twitter.com/MarcoWorms/status/1483223651684081670">Abracadabra + Yearn case</a></p>
<section id="yearn-vaults-yvaults" class="level2">
<h2 class="anchored" data-anchor-id="yearn-vaults-yvaults">Yearn Vaults (yVaults)</h2>
<p>The short way to name a Yearn Vault is <strong>yVault</strong>. In Yearn’s current version (v2) these are the characteristics of a yVault:</p>
<ul>
<li><p><strong>The token you deposit in a yVault is the token you’ll receive yield</strong>, always automatically compounded into the yVault</p></li>
<li><p><strong>A yVault may have many active strategies at the same time</strong>. A yVault may change its strategies capital allocation when it deems necessary</p></li>
<li><p>Unlike many other yield aggregators, <strong>there are no deposit/withdrawal fees</strong> charged to the user</p></li>
<li><p><strong>yVaults tokens implement the ERC20 standard</strong>, this means that they can be easily moved between wallets and markets and can be used by any app that communicates with this standard (like decentralized exchanges).</p></li>
</ul>
<p>Yearn Vault tokens are named “yvTokens”. yvETH represents a deposit position in the Ethereum vault, yvDAI in the DAI vault, yvUSDC in the USDC vault, etc.</p>
</section>
<section id="strategies-and-strategists" class="level2">
<h2 class="anchored" data-anchor-id="strategies-and-strategists">Strategies and Strategists</h2>
<p><strong>Strategists</strong> are people that build one or more underlying <strong>Strategies </strong>for yVaults</p>
<p><a href="https://docs.yearn.finance/developers/v2/getting-started">Anyone can build a Strategy</a>, but in order to get it added to a yVault, the strategist needs to pass the strategy through <a href="https://docs.yearn.finance/developers/v2/getting-started#overview-of-our-vetting-process">the strategy vetting process</a> which includes concept vetting, code review, security review, and Ethereum mainnet testing.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/13056/1*SpI9Okc__uDLVlq_Yc8wQw.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><a href="https://docs.yearn.finance/developers/v2/getting-started#overview-of-our-vetting-process">Strategy Vetting Process</a></figcaption>
</figure>
</div>
<p>For their efforts, strategists are rewarded with a portion of the strategy’s performance fee.</p>
<ul>
<li><p>Up to 10% of the generated yield fees by a specific strategy (performance fee) goes to the strategist</p></li>
<li><p>10% of the generated yield fees by all strategies (performance fee) goes to the Yearn DAO treasury.</p></li>
<li><p>Over the year 2% of the vault’s total assets are taken as fees which go to Yearn to pay for expenses like gas, developer grants, and other services.</p></li>
</ul>
<p>Now that we know what yVaults and Strategies are, let’s dig a bit deeper into how their inner workings</p>
</section>
<section id="diving-deeper-into-vaults-and-strategies" class="level2">
<h2 class="anchored" data-anchor-id="diving-deeper-into-vaults-and-strategies">Diving Deeper into vaults and Strategies</h2>
<section id="breaking-down-one-strategy" class="level3">
<h3 class="anchored" data-anchor-id="breaking-down-one-strategy">Breaking down one strategy</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/2048/0*n4v8MB5KSs1FspkJ.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Thanks <a href="https://twitter.com/finematics">Finematics</a> for this image!</figcaption>
</figure>
</div>
<p>The above image is an overview of the Ethereum vault strategy on a version 1 yVault. yVaults are now in version 2 and can handle multiple strategies at the same time, but this example will focus on a single strategy. There is an <a href="https://finematics.com/yearn-vaults-eth-vault-explained/">entire Finematics post and video</a> on how this works in case you want to dive deeper!</p>
<p>In this example, we can see how a strategy may use other vaults! In the Ethereum v1 yVault strategy:</p>
<ul>
<li><p>When a user deposits ETH the ETH is then lent at MakerDAO as collateral</p></li>
<li><p>The collateral is used to borrow DAI</p></li>
<li><p>The borrowed DAI is deposited into the DAI yVault</p></li>
</ul>
<p>So then we use ETH to borrow DAI and generate yield using the DAI yVault strategy.</p>
</section>
<section id="howwhen-does-yearn-move-the-funds-inside-the-vault-and-charge-fees" class="level3">
<h3 class="anchored" data-anchor-id="howwhen-does-yearn-move-the-funds-inside-the-vault-and-charge-fees">How/when does Yearn move the funds inside the vault and charge fees?</h3>
<p>One of the key functions of a strategy is called “harvest”. When called, it triggers a rebalancing process where profit is realized and reinvested back into the strategy.</p>
</section>
<section id="how-does-yearn-guarantee-a-strategy-always-generates-tokens-instead-of-losing-them" class="level3">
<h3 class="anchored" data-anchor-id="how-does-yearn-guarantee-a-strategy-always-generates-tokens-instead-of-losing-them">How does Yearn guarantee a strategy always generates tokens instead of losing them?</h3>
<p>Strategists use a number of tools to monitor on-chain data to ensure strategy health. One of those tools is <a href="https://yearn.watch/">Yearn Watch</a> which presents a nice UI with many key metrics live from the blockchain.</p>
<p>Just as important as monitoring strategies <em>after</em> they go to production is the due diligence done <em>before</em> they are sent to production with real money. The Yearn strategy team also has a “Strategy Scoring System” which evaluates the risk level for the underlying strategies used, we hope to expose this better to our users in our documentation and apps in the future!</p>
</section>
<section id="strategies-have-constraints-learned-by-experience-with-past-vaults" class="level3">
<h3 class="anchored" data-anchor-id="strategies-have-constraints-learned-by-experience-with-past-vaults">Strategies have constraints learned by experience with past vaults</h3>
<ul>
<li><p>Vault funds should go “up only” and not down</p></li>
<li><p>Avoid Impermanent Loss (e.g.&nbsp;don’t provide YFI/ETH liquidity in a liquidity pool)</p></li>
<li><p>Users should be able to withdraw at any time (so the strategy can’t timelock all vault funds, only a small fraction)</p></li>
<li><p>Use only protocols with a proven track record and well-understood, immutable contracts</p></li>
</ul>
</section>
<section id="keep3rs-and-yvaults" class="level3">
<h3 class="anchored" data-anchor-id="keep3rs-and-yvaults">Keep3rs and yVaults</h3>
<p>Yearn and <a href="https://docs.keep3r.network/">Keep3r</a> have a really strong synergy: Keep3r is used by yVaults to automate common vault tasks. For example, Keepers <em>(people available in the Keep3r network to do jobs when you need to) </em>could benefit from calling the <em>harvest</em> function whenever conditions make sense for the yVault, like:</p>
<ul>
<li><p>A strategy has earned X amount of profit</p></li>
<li><p>It has been Y amount of time since the last harvest</p></li>
<li><p>There is no loss that will happen if harvest is called</p></li>
</ul>
<p>And there are many cases like this, another example would be a Keeper calling for a rebalancing of the vault assets allocation in order to avoid liquidation in some part of the strategy</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*RU8sUADKESZxJ92f.jpg" class="img-fluid"></p>
</section>
<section id="building-strategies" class="level3">
<h3 class="anchored" data-anchor-id="building-strategies">Building Strategies</h3>
<ul>
<li><p><strong>yVaults </strong>are programmed in <a href="https://vyper.readthedocs.io/en/stable/">**Vyper</a>**</p></li>
<li><p><strong>Strategies </strong>are programmed in <a href="https://docs.soliditylang.org/en/v0.8.11/">**Solidity</a>** &gt; <em>You don’t need to be an advanced developer or financial analyst to become a strategist!</em></p></li>
</ul>
<p>While the maintenance of yVaults is a more complex development matter, Strategies were designed for anyone to be able to write one, the requirement for a good strategy is:</p>
<ul>
<li><p>Knowledge about the blockchain ecosystem you’ll deploy in, which can be acquired by doing in-depth research of tokenomics and documentation for all tokens used in the strategy itself.</p></li>
<li><p>Solidity programming knowledge similar to <a href="https://cryptozombies.io/">completing Level 4 on CryptoZombies</a></p></li>
<li><p>Know how to get around <a href="https://git-scm.com/">git</a>, <a href="https://eth-brownie.readthedocs.io/en/stable/">eth-brownie</a>, and <a href="https://trufflesuite.com/ganache/">ganache</a>.</p></li>
<li><p>After understanding the basics of the above tools you are ready to <a href="https://github.com/yearn/brownie-strategy-mix">copy our strategy template</a>! The functions you should start changing in this template in order to build with your own first strategy are <em>prepareReturn</em>, <em>adjustPosition</em>, and <em>liquidatePositon.</em></p></li>
</ul>
<p>One last thing: after a strategy is endorsed by Yearn and put in production you should help monitor it!</p>
</section>
</section>
<section id="learn-more" class="level2">
<h2 class="anchored" data-anchor-id="learn-more">Learn more</h2>
<p>If you want more content about Vaults and Strategies check out these resources! They all helped me understand the concepts explained in this article, also Yearn contributooooors are the kindest people and always help me find the best resource to get quality information on each subject.</p>
<ul>
<li><p><a href="https://vaults.yearn.finance/">yVaults descriptions</a></p></li>
<li><p><a href="https://docs.yearn.finance/getting-started/products/yvaults/overview">yVault/ Docs</a></p></li>
<li><p><a href="https://www.youtube.com/watch?v=NVR3teJw0Y0">Become a mighty strategist</a></p></li>
<li><p><a href="https://finematics.com/yearn-vaults-eth-vault-explained/">External video/article from Finematics about yVaults</a></p></li>
<li><p><a href="https://medium.com/iearn/yearn-partners-building-with-yvaults-4cd042ea092">Partners building with yVaults</a></p></li>
<li><p><a href="https://docs.yearn.finance/developers/v2/hacking-with-yearn">Hacking with Yearn</a></p></li>
<li><p><a href="https://docs.yearn.finance/developers/v2/additional-resources">Additional Resources from Yearn</a></p></li>
</ul>
</section>
<section id="take-the-blue-pill" class="level2">
<h2 class="anchored" data-anchor-id="take-the-blue-pill">Take the Blue Pill!</h2>
<p>If you loved the Vaults and Strategies abstraction:</p>
<ul>
<li><p>Stay updated with our latest news at the <a href="https://twitter.com/iearnfinance">Yearn Finance Twitter</a></p></li>
<li><p>Read our <a href="https://thebluepill.eth.link/">Blue Pill Book</a> outlining Yearn’s vision and history</p></li>
<li><p>And see about <a href="https://yearnfinance.notion.site/Join-Us-3e9c95b9bd7846a18c0f1cbe6ab05eda">Joining the Yearn team</a>!</p></li>
</ul>
<p><em>Producer: <a href="https://twitter.com/MarcoWorms">Worms</a>, Reviewers: <a href="https://twitter.com/wavey0x">Wavey</a></em></p>
<p><em>Thanks Farrah and Weaver for helping me onboard Yearn and connecting me with awesome people and resources that allowed me to write this first article here!</em></p>
</section>
<section id="made-in-yearn.finance" class="level2">
<h2 class="anchored" data-anchor-id="made-in-yearn.finance">Made in <a href="http://yearn.finance/">yearn.finance</a></h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>