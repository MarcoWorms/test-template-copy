<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marco Guaspari Worms">
<meta name="dcterms.date" content="2022-04-19">

<title>Worms Blog - Yearn governance explained: Proposals, $YFI token, and execution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Worms Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MarcoWorms" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MarcoWorms" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Yearn governance explained: Proposals, $YFI token, and execution</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">english</div>
                <div class="quarto-category">yearn</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Marco Guaspari Worms </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 19, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="https://cdn-images-1.medium.com/max/4000/0*bjoGD9v3LmSWifUk.png" class="img-fluid"></p>
<p>Anyone can discuss or propose ideas in the Yearn’s <a href="https://discord.com/invite/6PNv2nF">Discord</a>, <a href="https://twitter.com/iearnfinance">Twitter</a>, <a href="https://www.reddit.com/r/yearn_finance">Reddit</a>, <a href="https://yearnfinance.notion.site/yearnfinance/Pool-of-Ideas-d75383ade9154d8bb6163388c6c2b39b">Pool of Ideas</a>, <a href="https://t.me/yearnfinance/">Telegram</a>, and <a href="https://gov.yearn.finance/">Governance Forum</a>. As proposals mature it becomes a structured vote in the Governance Forum where the <a href="https://www.coingecko.com/en/coins/yearn-finance">YFI token</a> is used as voting power.</p>
<ul>
<li><p>Token holders can vote at <a href="https://yearn.snapshot.page/#/">Yearn Snapshots Page</a>, there is no gas consumption in the voting transaction!</p></li>
<li><p>There is also a <a href="https://docs.yearn.finance/contributing/governance/proposal-repository">retired governance repository</a> which is now unused but can be explored to learn about YFI history!</p></li>
</ul>
<p>The most common type of proposals in the forum are Yearn Improvement Proposals (YIPs) but there are other types covered in the <a href="https://gov.yearn.finance/t/yip-61-governance-2-0/10460">current Yearn governance implementation (YIP-61)</a>:</p>
<ul>
<li><p><strong>Yearn Improvement Proposal (YIP):</strong> A proposal to execute any power delegated to YFI holders or outside the scope of enumerated powers</p></li>
<li><p><strong>Yearn Delegation Proposal (YDP):</strong> A proposal to change how a yTeam has power over a scope</p></li>
<li><p><strong>Yearn Signaling Proposal (YSP):</strong> A non-binding proposal to signal community feelings or intent on any issue</p></li>
</ul>
<section id="governance-scope" class="level2">
<h2 class="anchored" data-anchor-id="governance-scope">Governance: Scope</h2>
<p><a href="https://gov.yearn.finance/t/yip-61-governance-2-0/10460">YIP-61</a> determines how Yearn governance currently works: <a href="https://gov.yearn.finance/t/yip-61-governance-2-0/10460#yteams-9">yTeams</a> have delegated authority from YFI holders to utilize limited powers autonomously. Holding YFI allows one to have control over how the power is distributed among teams, YFI gives exclusive voting power to pass or deny changes that shift power dynamics within the protocol such as:</p>
<ul>
<li><p>Change Multisig or yTeams Signers</p></li>
<li><p>Ratify yTeams</p></li>
<li><p>Spend Treasury Funds</p></li>
<li><p>Set Protocol Fees</p></li>
<li><p>Change YFI contract</p></li>
</ul>
</section>
<section id="governance-proposal-template" class="level2">
<h2 class="anchored" data-anchor-id="governance-proposal-template">Governance: Proposal Template</h2>
<p>Anyone is able to create a new proposal at <a href="https://gov.yearn.finance/">Yearn Governance Forums</a>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/2000/0*bo7legvlneeJ0jV5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Interface to create a proposal at the forum</figcaption>
</figure>
</div>
<p>As established by <a href="https://gov.yearn.finance/t/yip-55-formalize-the-yip-process/7959">YIP-55</a> here is a standard way to write proposals:</p>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary"><strong>Summary</strong></h3>
<p>The outcome of the proposed change, written in a non-technical and accessible manner</p>
<p><strong>Status: </strong><em>not required but it helps everyone, one of the three below:</em></p>
<ul>
<li><p><strong>Discussion:</strong> This proposal is currently in the discussion phase. As per our voting rules outlined in YIP-55, it will be in discussion for at least 3 days with a non-binding forum poll to gauge sentiment before it can be assigned a YIP number and move to Snapshot for a binding vote</p></li>
<li><p><strong>Voting:</strong> This proposal is currently in the voting phase. Cast your vote on Snapshot. You can learn about our voting rules in YIP-55</p></li>
<li><p><strong>Passed:</strong> This proposal passed on April 25, 2021 at 7:00 UTC with 99.97% voting for</p></li>
</ul>
</section>
<section id="abstract" class="level3">
<h3 class="anchored" data-anchor-id="abstract"><strong>Abstract</strong></h3>
<p>A short (~200 words) description of the proposed change. Should clearly describe what happens if the proposal passes.</p>
</section>
<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation"><strong>Motivation</strong></h3>
<p>The current problem that made you write the change proposal</p>
</section>
<section id="specification" class="level3">
<h3 class="anchored" data-anchor-id="specification"><strong>Specification</strong></h3>
<p>A long description of how this proposal solves the problem, should describe how to implement</p>
</section>
<section id="poll" class="level3">
<h3 class="anchored" data-anchor-id="poll"><strong>Poll</strong></h3>
<p>A voting dynamic that is built in the governance forum to gauge the community sentiment on the proposal, should be greater than 50%</p>
</section>
</section>
<section id="governance-discussion" class="level2">
<h2 class="anchored" data-anchor-id="governance-discussion">Governance: Discussion</h2>
<p>There should be enough time (at least 3 days) for discussion so the proposal can be tackled from many angles by community members. Use discourse’s built-in Poll tool to gauge the community sentiment about the proposal before raising a formal vote, the poll should have at least 50% passing votes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/2000/0*bq2-a7J0itHFDVtK.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example poll</figcaption>
</figure>
</div>
<p>Discussions ideally should take as long as it takes to clarify what was proposed to the community. Talking to different stakeholders <strong>before</strong> proposing something is a good way to measure sentiment and helps you introduce complex ideas with better support right from the start. An example of a proposal with excellent discussion is <a href="https://gov.yearn.finance/t/yip-57-funding-yearns-future/9319">YIP-57</a> which minted 6,666 YFI tokens beyond the 30,000 initial supply and had to align different types of stakeholders from DAO members to big YFI holders.</p>
</section>
<section id="governance-voting" class="level2">
<h2 class="anchored" data-anchor-id="governance-voting">Governance: Voting</h2>
<p>After the discussion step passed the proposal becomes a YIP (or maybe a YDP depending on its content) and will be put through the voting phase. To submit a vote at <a href="https://yearn.snapshot.page/#/">Yearn’s Snapshots Page</a> you need to hold at least 1 $YFI or ask someone to do it for you, if the proposal is solid this won’t be a barrier. Communicate with a forum mod to get an official number for the new YIP!</p>
<p>Voting power corresponds 1:1 to how much $YFI a voter has. So a wallet with 10 $YFI has 10x the voting power as someone with 1 $YFI.</p>
<p>Voting takes at least 5 days and needs more than 50% passing votes, there is no quorum to be met as outlined by <a href="https://gov.yearn.finance/t/yip-55-formalize-the-yip-process/7959">YIP-55</a>: “quorum requirement might be difficult to quantify and could lead to time-consuming rallying of apathetic voters”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/2038/0*2Vz6I_pz9xQjzpXw.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">How it looks like to vote at <a href="https://snapshot.org/#/">snapshot.org</a></figcaption>
</figure>
</div>
<p>Holding or staking YFI in the following places allows you to vote:</p>
<ul>
<li><p>Your wallet</p></li>
<li><p>YFI yVault V2 (equivalent to holding the yvYFI token)</p></li>
<li><p>Balancer YFI/WETH LP token</p></li>
<li><p>Uniswap YFI/WETH LP token</p></li>
<li><p>Sushiswap YFI/WETH LP token staked in MasterChef</p></li>
<li><p>MakerDAO YFI collateral</p></li>
<li><p>Unit Protocol YFI collateral</p></li>
<li><p>Bancor</p></li>
</ul>
</section>
<section id="governance-conclusion-execution" class="level2">
<h2 class="anchored" data-anchor-id="governance-conclusion-execution">Governance: Conclusion &amp; Execution</h2>
<p>If the voting has passed with over 50% votes Yearn DAO must execute it. The way <a href="https://yearnfinance.notion.site/yearnfinance/Welcome-to-Yearn-Finance-26d6c4210e3e405c9f02f84ba567a249">Yearn DAO</a> works is not like a top-down command &amp; control company, so it won’t enforce or obligate a team or any individual to execute the proposal. The DAO will ensure that the correct incentives are set for the proposal to be executed (for example allocate treasure to pay for work done by contributors)</p>
<p>Recently 2 YIPs were passed and are being executed by Yearn as I write this piece:</p>
<ul>
<li><p><a href="https://gov.yearn.finance/t/yip-65-evolving-yfi-tokenomics/11994"><strong>YIP-65: </strong>Evolving YFI Tokenomics</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-66-streamlining-contributor-compensation/12247"><strong>YIP-66: </strong>Streamlining contributor compensation</a></p></li>
</ul>
</section>
<section id="fair-launch-of-yfi" class="level2">
<h2 class="anchored" data-anchor-id="fair-launch-of-yfi">Fair launch of YFI</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn-images-1.medium.com/max/2000/0*xaIDfgO-0SViWeaw.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Taken from one of Cronje’s posts</figcaption>
</figure>
</div>
<p><a href="https://medium.com/@andrecronje">Andre Cronje</a> was the first builder of Yearn and what he sparked became a DAO with now over 200 active participants. This is only possible to exist as is today because Cronje gave away every inch of power he had over the protocol, and the way he did it was through YFI. Whoever used Yearn services and ecosystem in the early days received this power, and you can find information on how this process happened in these posts:</p>
<ol type="1">
<li><p><a href="https://medium.com/iearn/yfi-df84573db81">**YFI</a> **<em>(Earning YFI is simple, provide liquidity to one of the platforms)</em></p></li>
<li><p><a href="https://medium.com/iearn/earning-yfi-y-curve-fi-53b5fd347f0f">**Earning YFI curve.fi/y</a> **<em>(Earn YFI by providing liquidity to curve)</em></p></li>
<li><p><a href="https://medium.com/iearn/yfi-rewards-pool-810ef9256ec6">**YFI rewards pool</a>** <em>(Reward pool for burning YFI)</em></p></li>
<li><p><a href="https://medium.com/iearn/pool-3-meta-yield-governance-58f68e6d2f19">**Pool #3 Meta Yield Governance</a> **<em>(Pool that rewarded many things including participating in governance)</em></p></li>
</ol>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<p>If you are looking for inspiration to make a proposal you can take a look at the following YIPs which had extensive discussions and changed power dynamics within the protocol:</p>
<ul>
<li><p><a href="https://gov.yearn.finance/t/yip-32-remove-yfi-burning/1907"><strong>YIP 32: </strong>Remove YFI burning</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-36-system-rewards-as-operational-capital/2311"><strong>YIP 36: </strong>System Rewards as Operational Capital</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-41-temporarily-empower-multisig/3630/2"><strong>YIP 41: </strong>Temporarily Empower Multisig</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-51-set-vault-v2-fee-structure/7752"><strong>YIP-51: </strong>Set Vault v2 fee structure</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-52-make-strategist-skin-in-game-partner-for-make-benefit-of-glorious-brain-of-yearn/7856"><strong>YIP-52: </strong>Make Strategist Skin in Game Partner for Make Benefit of Glorious Brain of Yearn</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-54-formalize-operations-funding/7956"><strong>YIP-54: </strong>Formalize Operations Funding</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-55-formalize-the-yip-process/7959"><strong>YIP-55: </strong>Formalize the YIP Process</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-56-buyback-and-build/8929"><strong>YIP-56: </strong>Buyback and Build</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-57-funding-yearns-future/9319"><strong>YIP-57: </strong>Funding Yearn’s Future</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-61-governance-2-0/10460"><strong>YIP-61: </strong>Governance 2.0</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-65-evolving-yfi-tokenomics/11994"><strong>YIP-65: </strong>Evolving YFI Tokenomics</a></p></li>
<li><p><a href="https://gov.yearn.finance/t/yip-66-streamlining-contributor-compensation/12247"><strong>YIP-66: </strong>Streamlining contributor compensation</a></p></li>
</ul>
<p><em>Producer: <a href="https://twitter.com/MarcoWorms">Worms</a></em>, *Reviewer: <a href="https://twitter.com/tracheopteryx">*Tracheopteryx</a></p>
</section>
<section id="made-in-yearn.finance" class="level2">
<h2 class="anchored" data-anchor-id="made-in-yearn.finance">Made in <a href="http://yearn.finance/">yearn.finance</a></h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>