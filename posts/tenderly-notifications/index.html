<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marco Guaspari Worms">
<meta name="dcterms.date" content="2022-03-18">

<title>Worms Blog - Setup notifications for blockchain transactions with Tenderly</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Worms Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MarcoWorms" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MarcoWorms" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Setup notifications for blockchain transactions with Tenderly</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">english</div>
                <div class="quarto-category">tenderly</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Marco Guaspari Worms </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 18, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>In <a href="https://medium.com/iearn/yearn-finance-partners-with-tenderly-to-supercharge-development-debugging-incident-analysis-6489260298a5">the article where Yearn announced a partnership with Tenderly</a> there was a section where we said: &gt; “Tenderly has built-in customizable alerts that allow even novice users to create alerts on virtually any on-chain event.”</p>
<p>A Yearn contributor reached out to learn more about this, and I think it’s a great opportunity to showcase this feature! Let’s start by taking a look at which networks can we use with Tenderly besides Ethereum Mainnet:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*Wl1GFyFM0A_rsKjO.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Networks supported by Tenderly</figcaption>
</figure>
</div>
<p>I’m gonna explore the <strong>“Monitoring -&gt; Alerting”</strong> service located at <a href="https://dashboard.tenderly.co/">Tenderly’s dashboard</a> sidebar after logging into any project:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*mG1NxKBKDjOy2OJ5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Sidebar on the left side after logged-in</figcaption>
</figure>
</div>
<p>There is a caveat to this service about free usage that will show up when you open the Alerting page: &gt; <em>You’ll receive a batch of alerts that happened over 15 minutes. Upgrade your plan to Tenderly Pro/Dev to receive real-time alerts</em></p>
<p>For testing, this isn’t a problem you so can proceed with the free version. For a more robust usage of alerts, you’ll have to upgrade your account.</p>
<p>Let’s start by checking everything can we do when trying to <strong>create a new alert. </strong>The article won’t explore all possibilities so take a look at them to understand the best usage for your needs:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*ivY6LieHeBRlNGvI.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Create alert</figcaption>
</figure>
</div>
<ul>
<li><strong>Alert Type</strong> will be the conditions we’ll set for a chain event to trigger a notification:</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*4o1A4-U8GtdH3AAL.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">all Alert Types</figcaption>
</figure>
</div>
<ul>
<li><strong>Alert Target</strong> will be the contract monitored for the above events and conditions:</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*NwaWo4VDNEmiOBU5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">all Alert Targets</figcaption>
</figure>
</div>
<ul>
<li><strong>Alert Destinations</strong> will be the places that will receive notifications when the above contract meets the conditions for an alert:</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*lVZTp3HG0637k3H1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">all Alert Destinations</figcaption>
</figure>
</div>
<p>Before creating a new alert we must first:</p>
<ul>
<li><p>Decide which events of which contract we want to be notified about</p></li>
<li><p>Add the contract we want to listen to in the “Contracts” tab, so we’ll be able to target it in step 2</p></li>
<li><p>Connect with destinations that will receive the messages (we’ll use telegram in this guide) so we’ll be able to send notifications to it in step 3</p></li>
</ul>
<p>Now let’s get started!</p>
<section id="add-telegram-as-a-destination" class="level2">
<h2 class="anchored" data-anchor-id="add-telegram-as-a-destination">Add Telegram as a destination</h2>
<p>In the alerting tab, go to “Destinations” on the top menu and click on “Telegram”:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*zssrqIaeZdmRlLq1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Add Telegram as destination</figcaption>
</figure>
</div>
<p>Label it and follow the instructions to allow the bot to send you messages:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*Hc-GKGgdwnQKqsJK.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Follow instructions to allow the bot to send messages to you</figcaption>
</figure>
</div>
<p>To complete the above process copy the “magic words” from instruction step 3. Paste it in the chat with Tenderly’s telegram bot that opens by clicking <a href="https://t.me/TenderlyRobot"><span class="citation" data-cites="TenderlyRobot">@TenderlyRobot</span></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*RB_mzUO1pFqbBii5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Confirmation message that the bot can now send messages in this chat!</figcaption>
</figure>
</div>
</section>
<section id="monitoring-yearn-vault-depositswithdrawals" class="level2">
<h2 class="anchored" data-anchor-id="monitoring-yearn-vault-depositswithdrawals">Monitoring Yearn Vault deposits/withdrawals</h2>
<p>Let’s start by monitoring some events made on the SPELL yVault on the Fantom Network. We need to know the SPELL yVault contract address, we can find it by going to the <a href="https://yearn.finance/#/vaults">Yearn Vaults interface</a> and clicking on the SPELL vault</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*iN0jkDc7V1kzSpDV.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Yearn Vaults at Fantom</figcaption>
</figure>
</div>
<p>After clicking on it we’ll see this page with all the vault details, click the “block explorer” button that will take you to the vault’s contract:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*Fcm0MguvUpCtEUTd.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">SPELL yVault details</figcaption>
</figure>
</div>
<p>This will open up the <a href="https://ftmscan.com/address/0xD3c19eB022CAC706c898D60d756bf1535d605e1d">SPELL yVault Contract on FTMScan</a> (Fantom fork of <a href="https://etherscan.io/">Etherscan</a>):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*E-dHsAF2OMaWxVyj.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><a href="https://ftmscan.com/address/0xD3c19eB022CAC706c898D60d756bf1535d605e1d">SPELL yVault Contract on FTMScan</a></figcaption>
</figure>
</div>
<p>I highlighted the important information for our use-case in order:</p>
<ul>
<li><p>First the contract address</p></li>
<li><p>Then the “Token Name” (helps when you have many contract tabs open)</p></li>
<li><p>Lastly the history of methods (functions) that this contract executed</p></li>
</ul>
<p>For our example, <strong>we’ll add a notification for when anyone deposits tokens to the vault</strong>. To do this copy the contract page URL:</p>
<p><a href="https://ftmscan.com/address/0xD3c19eB022CAC706c898D60d756bf1535d605e1d">https://ftmscan.com/address/0xD3c19eB022CAC706c898D60d756bf1535d605e1d</a></p>
<p>Then go to Tenderly’s contract tab and click to import this contract in their dashboard, this will enable us to create alerts for it:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*mWuwKsrD4vpA8H16.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Importing contract in Tenderly</figcaption>
</figure>
</div>
<p>Paste the address, select the “Vyper Contract” (name shows like this because Yearn Vaults use <a href="https://vyper.readthedocs.io/en/stable/index.html">Vyper programming language</a>). When it shows up, click “Import”:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*5rsE4SW66rahd21Q.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Importing contract in Tenderly</figcaption>
</figure>
</div>
<p>After importing the contract is ready for us to create an alert for it!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*5rsE4SW66rahd21Q.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Importing contract in Tenderly</figcaption>
</figure>
</div>
<p>Let’s go and create an alert then:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*NxXHSz8Zvu-X4QVG.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Creating a new alert</figcaption>
</figure>
</div>
<p>We want to receive a notification every time someone deposits into the SPELL yVault. To do this we’ll check the “Deposit” method that exists in the yVault contract. “method” is an analogous name to “function call” so that’s the type of alert we’ll use in this case</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*9pHnL-7ky-zagKYn.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Select alert type</figcaption>
</figure>
</div>
<p>Target will be an address:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*D_9J0c78CVK5v8co.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Select alert target</figcaption>
</figure>
</div>
<p>You’ll be able to select the contract we added previously and then pick any function that exists inside it. Note that many functions might have similar names, functions that start with “_” are often private internal functions and won’t be the ones we are looking for</p>
<p>In this case, we have **_deposit** (private: for internal usage) and <strong>deposit</strong> (public: for external users). We’ll pick the one that is public:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*D_9J0c78CVK5v8co.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Select alert target</figcaption>
</figure>
</div>
<p>Lastly, choose the telegram destination that was set up previously and save the alert:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*D_9J0c78CVK5v8co.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Select alert destination</figcaption>
</figure>
</div>
<p>We are done! The alert is created and I’ll receive a message every time someone deposits SPELL in that yVault!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*ckXpYmgDqBsMqzCH.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Alert created successfully!</figcaption>
</figure>
</div>
<p>Here is an example notification I got after setting up this example and depositing a bit of spell in the vault to trigger it, I got the notification instantly after transaction confirmation!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://miro.medium.com/v2/format:webp/0*ckXpYmgDqBsMqzCH.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Notification of new SPELL deposit at Fantom yVault sent to my Telegram!</figcaption>
</figure>
</div>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>This Yearn example showcases a simple way to monitor for a contract’s function call. If you explore all the options from the alerting system you’ll see this can be easily tweaked to many different usages, for example:</p>
<ul>
<li><p>NFT collections devs can monitor whenever their contract called the minting of a new token and announce it automatically on Discord</p></li>
<li><p>People monitoring Tokenomics flows can use notifications to keep an eye on wallet balances and actions from contracts to see if devs are doing what is expected to be done</p></li>
</ul>
<p>You can monitor any kind of on-chain activity and be notified by it, so experiment with all the different options!</p>
<p>Producers: <a href="https://twitter.com/MarcoWorms">Worms</a>, Reviewers: <a href="https://twitter.com/cryptouf">Cryptouf</a>, <a href="https://github.com/DarkGhost7">Dark Ghosty</a></p>
</section>
<section id="made-in-yearn.finance" class="level2">
<h2 class="anchored" data-anchor-id="made-in-yearn.finance">Made in <a href="https://yearn.finance/">yearn.finance</a></h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>